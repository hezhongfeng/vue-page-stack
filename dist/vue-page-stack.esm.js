import{defineComponent as e,getCurrentInstance as t,setTransitionHooks as n}from"vue";const r=e=>null==e,o=e=>r(e)||""===e,a={keyName:"page_key",componentName:"StackRouterView"};let s;const u=e=>{s=Object.assign(Object.assign({},a),((e,...t)=>{const n={};if(!e||!t)return n;for(const o of t)r(e[o])||(n[o]=e[o]);return n})(e,"keyName","componentName"))},c=()=>s;var i;!function(e){e.PUSH="push",e.GO="go",e.REPLACE="replace",e.BACK="back",e.FORWARD="forward"}(i||(i={}));const l={value:i.PUSH},p=e=>{l.value=e},v=()=>l;let h;const d=()=>h;class m{constructor(e){var t;this.value=null!==(t=null==e?void 0:e.value)&&void 0!==t?t:[]}push(e){return this.value.push(e)}pop(){return this.value.pop()}removeAfter(e){const t=this.value.findIndex((t=>t.key===e));if(-1===t)return;const n=t+1;return n>=this.value.length?void 0:this.value.splice(n,this.value.length-t-1)}clear(){const e=this.value;return this.value=[],e}get(e){var t;return null===(t=this.value.find((t=>t.key===e)))||void 0===t?void 0:t.vnode}}const f=(()=>{const e=new m;return()=>e})();function g(e){let t=e.shapeFlag;256&t&&(t-=256),512&t&&(t-=512),e.shapeFlag=t}const y=e({inheritRef:!0,__isKeepAlive:!0,props:{component:{type:Object,default:void 0},route:{type:Object,required:!0}},setup(e){const r=f(),o=v(),{keyName:a}=c(),s=t(),u=s.ctx,l=s.suspense,{renderer:{p:p,m:h,um:d,o:{createElement:m}}}=u,y=m("div");function b(e){if(e)for(;e.length;){const t=e.pop();t&&(g(t.vnode),d(t.vnode,s,l))}}return u.activate=(e,t,n,r,o)=>{const a=e.component;h(e,t,n,0,l),p(a.vnode,e,t,n,a,l,r,o)},u.deactivate=e=>{h(e,y,null,1,l)},()=>{const{component:t,route:s}=e,u=s.query[a],c=r.get(u),l=t;return l?c?(b(r.removeAfter(u)),c.transition&&n(c,c.transition),c.shapeFlag|=512,c):(o.value===i.REPLACE&&b(r.clear()),r.push({key:u,vnode:l}),l.shapeFlag|=256,l):l}}}),b=()=>{const{keyName:e}=c(),{router:t}=d(),n=v();t.beforeEach(((t,r)=>{if(o(t.query[e])){t.query[e]=((e=6)=>Math.random().toString(16).substring(2,e+2))();const a=n.value===i.REPLACE||o(r.query[e]);return{hash:t.hash,path:t.path,name:t.name,params:t.params,query:t.query,meta:t.meta,replace:a}}return!0}))},k={install(e,t){const{router:n}=t;if(!n)throw Error("\n vue-router is necessary. \n\n");u(t),h={app:e,router:n},(()=>{const{app:e,router:t}=d(),n=t.push.bind(t),r=t.go.bind(t),o=t.replace.bind(t),a=t.back.bind(t),s=t.forward.bind(t);e.config.globalProperties.$router||e.use(t),t.push=e=>(p(i.PUSH),n(e)),t.go=e=>{p(i.GO),r(e)},t.replace=e=>(p(i.REPLACE),o(e)),t.back=()=>{p(i.BACK),a()},t.forward=()=>{p(i.FORWARD),s()}})(),(()=>{const{componentName:e}=c(),{app:t}=d();t.component(e,y)})(),b()}};export{k as VuePageStack,v as useAction,f as useStack};
//# sourceMappingURL=vue-page-stack.esm.js.map
